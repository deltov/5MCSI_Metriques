<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Graphique des commits</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  </head>
  <body>
    <h2 style="text-align:center;">Commits GitHub par date et heure</h2>
    <div id="commit_chart" style="width: 100%; height: 500px;"></div>

    <script type="text/javascript">
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn("string", "Date/Heure");
        dataTable.addColumn("number", "Commits");
        
        const rawData = {{ commit_data | tojson }};
        const commitCount = {};

        rawData.forEach(entry => {
          const datetime = entry.datetime;
          commitCount[datetime] = (commitCount[datetime] || 0) + 1;
        });

        for (const [datetime, count] of Object.entries(commitCount)) {
          dataTable.addRow([datetime, count]);
        }

        const options = {
          title: "Nombre de commits GitHub par date et heure",
          hAxis: { title: "Date/Heure", slantedText: true, slantedTextAngle: 45 },
          vAxis: { title: "Commits" },
          legend: "none",
          bar: { groupWidth: "80%" }
        };

        const chart = new google.visualization.ColumnChart(document.getElementById("commit_chart"));
        chart.draw(dataTable, options);
      }
    </script>
  </body>
</html>
